

















基础设施智慧服务系统（iS3） 安装使用手册
















同济大学 土木信息技术教育部工程研究中心 中国智慧基础设施联盟


2018.11








 
 




目录 

第一章   概述 .................................................................... 1 


第二章  系统运行环境  ............................................................ 1 


2.1硬件要求  ...................................................................  1 

2.2操作系统要求  ...............................................................  1 

2.3数据库要求  .................................................................  1 

2.4运行所需插件要求  ...........................................................  1 


第三章   安装步骤 ................................................................ 2 


3.1安装客户端插件  .............................................................  2 
3.1.1 IronPython-2.7.5 ...................................................... 2 
3.1.2 UnityWebPlayer ........................................................ 3 
3.1.3 UnityWebPlayerFull .................................................... 4 

3.2安装客户端软件  .............................................................  5 


第四章  系统操作界面  ............................................................ 8 


4.1查看工程项目  ...............................................................  8 

4.2可视化交互界面  .............................................................  9 
4.2.1二维可视化界面 .........................................................   9 
4.2.2三维可视化界面 ........................................................   12 

4.3脚本语言交互/数据库查看界面  ............................................... 13 
4.3.1脚本语言交互界面 ......................................................   13 
4.3.2数据库查看界面 ........................................................   14 

4.4工程对象数交互界面  ........................................................  14 

4.5工程对象信息查看界面  ...................................................... 15 

4.6常见问题  ..................................................................  17 


第五章  某隧道数据配置案例  ..................................................... 18 
 

5.1新增工程  ..................................................................  18 

5.2数据配置  ..................................................................  18 
5.2.1设置配置工具路径 ......................................................   19 
5.2.2选择配置工程 ..........................................................   19 
5.2.3设置已选工程数据路径 ..................................................  20 
5.2.4二维数据配置 ..........................................................   21 
5.2.4数据对象组关联配置 ....................................................   25 
5.2.5数据对象树定义 ........................................................   30 

5.3数据集成  ..................................................................  32 

5.4数据关联  ..................................................................  33 

5.5数据二三维联动  ............................................................  34 


 
 


第一章 概述
iS3是基础设施智慧服务系统（infrastructure Smart Service System）的简 称，由同济大学自主研发，拥有完全自主知识产权。iS3是一套基础设施全寿命数 据采集、处理、表达、分析的一体化决策服务系统。主要服务于道路、桥梁、隧 道、综合管廊、基坑等基础设施对象，涵盖从规划、勘察、设计、施工到运营维护 各阶段不同信息流节点的全寿命周期。广义上讲，iS3适用于任何领域的信息化应 用。 
此文档介绍的是iS3基础设施智慧服务系统网络版的安装使用，iS3基础设施智 慧服务系统网络版是在单机版功能基础上，还具有通过iS3云服务在线管理基础设 施全寿命数据的能力，实时加载各种类型工程数据，并支持自定义分析工具等二次 开发功能。 

第二章 系统运行环境


2.1 硬件要求
	Intel 或 AMD  处理器 PC机 
⚫软件所占空间不超过1G磁盘空间 


2.2 操作系统要求
⚫32/64 位 Windows 7及以上 
	.net framework 4.5


2.3 数据库要求
	Sqlserver2008

2.4 运行所需插件要求
	Python插件：IronPython-2.7.5
	Unity3D插件: UnityWebPlayer和UnityWebPlayerFull
 


第三章 安装步骤


3.1 安装客户端插件
iS3基础设施智慧服务系统网络版运行需安装三个插件，插件安装包请通过百 度云网盘自行下载。下载后进入保存目录，按顺序依次安装即可。（百度云地址： https://pan.baidu.com/s/13u2mzuLzLWn0BVwQCkRNVw;密码：wisp） 







































3.1.1 IronPython-2.7.5 

iS3二次开发主要插件。双击【IronPython-2.7.5】，即可安装。安装完成后 关闭此页面即可。 
 


























3.1.2 UnityWebPlayer iS3平台三维界面主要插件。双击【UnityWebPlayer】，即可安装。安装完成
后关闭此页面即可。 

























 
 



























3.1.3 UnityWebPlayerFull iS3平台三维界面主要插件。双击【UnityWebPlayerFull】，即可安装。安装
完成后关闭此页面即可。 

























 
 




























3.2 安装客户端软件
iS3基础设施智慧服务系统安装包请通过百度云网盘自行下载。（百度云地 址：https://pan.baidu.com/s/13u2mzuLzLWn0BVwQCkRNVw;密码：wisp） 









下载文件夹iS3 v1.2后，进入保存目录，双击iS3 v1.2/bin/iS3.Desktop.exe
，便可运行iS3平台。进行系统配置后，输入账户密码即可运行主程序。默认初始 账户密码均为admin，主数据库IP为127.0.0.1，主数据库为iS3Project，数据库账 户为sa，数据库密码为123456。 
 
 











































 
 



登录成功后，此页面即为iS3平台主界面。 












工程项目 










 
 


第四章 系统操作界面
以iS3测试案例为例，介绍如何使用iS3平台基础功能。此案例的数据已导入软 件，无需再进行数据准备导入步骤。 

4.1 查看工程项目
滚动鼠标可放大/缩小地图，拖动鼠标可移动地图，移动鼠标至地图标记处显 示工程项目名称，点击【iS3测试案例】，即进入该项目的具体工程信息界面。 




























跳转此界面即为iS3测试案例的具体工程信息界面，根据操作可分为四块区 域。 
左上部分：可视化交互界面； 
左下部分：脚本语言交互界面/数据库查看界面； 
右上部分：工程对象数交互界面； 
右下部分：工程对象信息查看界面。 右上角为快捷键。 
右上角 ：返回系统主界面； 
右上角 ：运行脚本语言。 
 



可视化交互界面 


工程对象数交互界面 





脚本语言交互界面 




 
数据库查看界面 
 
工程对象信息查看界面
 









4.2 可视化交互界面
此模块可实现2D平面图/剖面图/数据视图/3D视图一体化联动，快速高效展示 工程信息。 
4.2.1 二维可视化界面 

单击【BaseMap】即可查看二维可视化界面，滚动鼠标可放大/缩小地图，鼠标 拖动拖动可移动地图。 























通过点击显示区上部	可对此界面进行基础操作。 
 


	可通过点选不同图层更改显示图层； 
 
	 单击此按钮，弹跳处右上标红区域，可通过鼠标拖动指针 旋转地图； 






















	随机选取一个监测点，单击此按钮，可将所要查看的监测 点/范围居于地图中心； 
 

 


	单击此按钮，可根据需求大范围选择所需查看信息； 






















	单击此按钮，弹跳出下列标红区域，可根据需求，布置点 线面等操作，单击最后一个按钮，即可关闭此界面。 


















 
 

4.2.2 三维可视化界面 

单击【Map3D】即可切换至三维可视化界面，滚动鼠标可放大/缩小地图，鼠标 右键拖动可旋转地图。 




















鼠标左键点击【Map3D】并拖动，可将二维、三维可视化界面并排显示。 

























 
例如选择左右排列，如下图所示。可通过选取任意一点监测点，在其任意界面 实现数据交互显示。 
 






























4.3 脚本语言交互/数据库查看界面
4.3.1 脚本语言交互界面 

切换至【Python】可根据需求对软件进行二次开发，配置iS3内置工具、查看 参数、分析工程信息等需求。 


























 
 

4.3.2 数据库查看界面 

切换至【Data List】便可对数据库进行查看，点击右上方【监测点】，数据 库中变会弹跳出此项目工程信息中所有监测点的信息。 




























单击【ID】此行任意名称，可根据其需求排序。 






4.4 工程对象数交互界面
iS3测试案例较为单一，仅有监测点显示，不同的工程项目可查看对象数不 同，较为复杂的工程项目可能包含地质、监测点等信息。 
 

 


4.5 工程对象信息查看界面
【Object View】可对工程信息分别进行曲线图、表格、文本形式查看。 






























单击	可将曲线图全屏，对于数据查看分析更加一目了然。 
 






















 
切换至【Tools】，可查看拓展分析工具，基于iS3框架自主开发相应的工具， 后续将陆续更新工具库内容。 
 


4.6 常见问题 Q1：插件安装完成后，在运行iS3.desktop.exe时，加载3D文件若卡死在如下界面 或加载失败，可尝试一下解决办法。 
 
方法一： 

根据链接下载unity文件夹，将下载好的unity文件夹复制至C:\Users\(当前用 户)\AppData\LocalLow\unity文件夹中，需先设置显示隐藏文件夹。 
（链接：https://pan.baidu.com/s/1uV4RqrbBI777ec9FfyaC1A 密码：k5jr） 方法二： 
重新安装Unity 3d  WebPlayer插件。 备注：若以上方法均无效，请关机重启或断网尝试再次运行iS3单机版。 
 


第五章 某隧道数据配置案例
本章将以基础设施智慧服务系统（iS3）数据准备手册第六章某隧道为例，讲 解如何将准备好的二维数据、三维数据集成进iS3平台。通过使用iS3-config配置 工具后，将二维数据、三维数据、数据库中的工程数据关联起来，实现二三维数据 联动。 

5.1 新增工程 
打开iS3平台，进入工程列表界面，点击左下角“新增工程”，填写工程ID为 “TunnelDemo”和工程描述信息“iS3 Chuzhou Trainning”。点击“选取地图位 置”，在右边地图区域点击工程相应的位置，然后点击“确定”按钮，即可添加工 程。 





























5.2 数据配置 
将采用配置工具iS3-Config进行iS3工程的数据配置工作。配置工具存放在“
iS3 V 1.2\iS3-Config\bin”目录下，双击“iS3.Config.exe”即可打开。 
 

5.2.1 设置配置工具路径 

打开配置工具后，进行iS3运行程序路径的设置，指定二维、三维数据的存放 位置，设置数据库地址（默认为本机，即127.0.0.1），填写数据库的登陆用户名 和密码 （ 默 认 用 户 名 ： sa ， 默认 密 码 ： 123456 ） 。 设置 完 毕 后 ， 点 击 “Start configuration”进行下一步。 






















5.2.2 选择配置工程 

工程列表将列出数据库“iS3Project”中“Sys_ProjectListInfo”表里存放 的工程，由于我们在5.1节中新增了一个“TunnelDemo”工程，因此可在列表中查 看。在“Avaliable Projects”中选择“TunnelDemo”工程，并点击“Next”进行 下一步。 
 
 

5.2.3 设置已选工程数据路径 

设置本工程的“ID”和“Title”为“TunnelDemo”，“Local data path”指 定本工程的二维数据、三维数据存放位置，“Local tile path”指定本工程的由 Arcgis导出的离线切片包位置。 
 
 



 

5.2.4 二维数据配置 

5.2.4.1 平面图配置 
点击左下角的“+”，新增一张二维地图。“Eng.Map ID”表示这张地图的编 号，设置 为 “Map0” ； “Eng.Map type” 表 示 这 张 地 图 的 类型 ，设置为 “FootPrintMap”，即平面图；“Local tiled map”表示要加载的离线切片包， 通过点击“…”打开选择窗口选择“Planview.tpk”； “Local GeoDB map”表示 要 加 载 的 geodatabase 文 件 ， 通 过 点 击 “…” 打 开 选 择 窗 口 选 择 “Planview.geodatabase”。 
 































































选择打开“Planview.geodatabase”文件后，可以将该文件含有的图层加载进 来，包括“River”、“TunnelPlan”和“MonPoint”。可以点击其中某一个图 层，对该图层的绘制方式进行设置。如选中“MonPoint”图层，再点击“Layer 
 

Setting”可对“MonPoint”进行设置。 

 
5.2.4.2 剖面图配置 

点击左下角的“+”，再新增一张二维地图。“Eng.Map ID”表示这张地图的 编号，设置 为 “Map1” ； “Eng.Map type” 表示这张地图的 类型 ，设置为 “GeneralProfileMap”，即剖面图；“Local tiled map”表示要加载的离线切片 包，通过点击“…” 打开选 择窗 口选 择“Profileview.tpk”； “Local GeoDB map” 表示要 加 载 的 geodatabase 文件 ， 通过 点击 “…” 打开 选 择 窗 口 选 择 “profileview.geodatabase”。 
 

 









































 
选择打开“profileview.geodatabase”文件后，可以将该文件含有的图层加 载进来，包括“Stratum”和“TunnelSection”。可以点击其中某一个图层，对该 图层的绘制方式进行设置。如选中“Stratum”图层，再点击“Layer Setting”可
 

对“Stratum”进行设置。 

 
配置完平面图和剖面图后，点击“Next”进入下一步。 5.2.4 数据对象组关联配置 
点击“Domains”下方的“+”按钮，可弹出“Input domain information”窗 口，添加本工程存在的“Domain”，选择“Geology”，点击“OK”即可添加。重 复本步骤，将 “Monitoring”和“Structure”也添加进来。 
 



 



在“Domains”选框里选中“Geology”，点击“Digital objects”下方的 “+”按钮，可弹出“Input digital object name”窗口，输入该Domain中存在的 对象组名“ALLSTRA”，即可添加该对象组。 
 
 

点击“Table name”后面的“…”按钮，选择数据库中本对象组对应的数据表 “STRA”，即可将对象组与该数据表关联起来。 




















 
勾选“Has 2D Model”，表示本对象组有相对应的二维图层与之关联。点击 “2D Layer”后的“…”按钮，选择剖面图“Map1”中的“Stratum”图层，即可 将对象组与该图层关联起来。 
 

在“Domains”选框里选中“Monitoring”，点击“Digital objects”下方的 “+”按钮，可弹出“Input digital object name”窗口，输入该Domain中存在的 对象组名“MonPoint”，即可添加该对象组。 



















 
点击“Table name”后面的“…”按钮，选择数据库中本对象组对应的数据表 “MonPoint”，即可将对象组与该数据表关联起来。 



















 
 

勾选“Has 2D Model”，表示本对象组有相对应的二维图层与之关联。点击 “2D Layer”后的“…”按钮，选择平面图“Map0”中的“MonPoint”图层，即可 将对象组与该图层关联起来。 




















 
勾选“Has 3D Model”，表示本对象组有相对应的三维图层与之关联。点击 “3D Layer”后的“…”按钮，选择“iS3Project/MonPoint/MonPoint”图层，即 可将对象组与该图层关联起来。 






















数据对象组关联配置完成后，点击“Next”进入下一步。 
 

5.2.5 数据对象树定义 

本节讲解如何配置对象树。 选中“Geology”选项卡，配置在该Domain里的对象树。在对象树（左边白色
框内）右击，点击“Add”，增加一个节点。 






















选中新增加的节点，往“Name”,“Display name”填入“地层”，将

“Digital objects”选择为对象组“ALLSTRA”，即可将对象树上的“地层”节点 与对象组“ALLSTRA”关联起来。 
 

选中“Monitoring”，配置在该Domain里的对象树。在对象树（左边白色框 内）右击，点击“Add”，增加一个节点。 




















 
选中新 增加的节点 ， 往 “ Name”,“Display name” ，分别 填写 为 “ 监测 点”，将“Digital objects”选择为对象 组“MonPoint”，即可将对象树上的 “监测点”节点与对象组“MonPoint”关联起来。 




















 
配 置 完 对 象 树 后 ， 按 “Finish” ， 即 可 生 成 “ TunnelDemo.py” 和 “TunnelDemo.xml”，保存在了\iS3 V 1.2\Data\TunnelDemo文件夹内。 
 


5.3 数据集成
经过了工程数据的准备以及数据配置的工作，运行iS3平台，可以在工程列表 中看到“TunnelDemo”工程，进入该项目。 






















 
进入项目后，可以看到iS3的加载过程。根据我们的配置需求，iS3平台将工程 数据以平面图、剖面图以及三维图加载了进来，说明程序完成了数据集成功能。 






















 
 

 


5.4 数据关联
在对象树中，我们选取“地层”节点，可以在“DataList”列表中查看该对象 组在数据库的信息，完成了对象树与对象组之间的关联。在剖面图内，或者数据表 内点击某个地层，可在右下角的对象查看框中看到该对象的信息，说明完成了对象 与数据表的关联。 






















 
 


5.5 数据二三维联动
在平面图上选取了一个监测点，在平面图中该监测点被高亮，在数据表中也高 亮了出来，在三维图中该监测点也被高亮。在三维图中选取一个监测点，也会发现 平面图、数据表中该点的信息被高亮。可以说明，程序已经完成了二三维联动的功 能。 
 



















iS3 岩石隧道数据准备手册
iS3 Data Preparation Manual for Rock Tunnel
















同济大学 土木信息技术教育部工程研究中心 中国智慧基础设施联盟



2018.11
 





目 录
第一章 iS3 岩石隧道数据准备总体流程	3
1.1 iS3 简介	3
1.2 iS3 岩石隧道数据准备总体流程	4
第二章 确定工程信息目录	5
第三章 数据库数据准备	6
3.1  填写 Excel 数据表格	6
3.2  导入数据库	6
第四章 二维数据准备	7
4.1 CAD 数据处理	7
4.2 ArcGIS 数据处理	7
第五章 三维数据准备	9
第六章 某隧道数据准备案例	10
6.1  案例简介 	 10
6.2  确定工程信息目录和信息节点 	 10
6.2  填写数据表格并导入数据库 	 18
6.3 二维数据准备 	 30
6.4 三维数据准备 	 71
附 录	93
附录 A   工程信息目录 	 93
附录 B	数据表格 	 102
附录 C	数据准备需要安装的软件 	 105
附录 D	岩石隧道 Revit 建模方法 	 106
 
第一章 iS3 岩石隧道数据准备总体流程


1.1 iS3 简介


基础设施智慧服务系统（iS3）：基础设施全寿命期的数据采集、处理、表达、分析和服 务的一体化智慧决策系统。iS3 主要服务于道路、桥梁、隧道、综合管廊、基坑等基础设施 对象，涵盖从规划、勘察、设计、施工到运营维护各阶段不同信息流节点的全寿命周期。广 义上讲，iS3 适用于任何领域的信息化应用。iS3 主要包含全寿命过程数据的采集、处理、表 达、分析和一体化决策服务几个部分组成，如图 1.1 所示。
























图 1.1   基础设施智慧服务系统（iS3）
iS3 平台以 Microsoft Visual Studio 为集成开发环境，以 Microsoft SQL Server 为数据库 支撑，以 ESRI 公司的 ArcGIS Runtime SDK 作为地图相关开发工具，在此基础上利用 C#、 Xaml 语言进行编程开发。iS3 平台基于 iS3Core 核心，实现了系统跨平台拓展，并内嵌 Python、 提供二次开发接口、插件式的开发功能，其功能主要体现在以下几个方面：
（1）数据管理
① 全生命期数据管理，覆盖勘察、设计施工监测运营维护。
② 同时管理多个工程。
③ 采用 XML 文件定义工程数据（属性库 MDB（SqlServer）、ArcGIS 地图数据 TPK
/Geodatabase)，轻松定义和添加新的工程。
（2）可视化
① 基于 ArcGIS 地理信息系统引擎，丰富的展现和可视化交互。
② 2D 平面图/剖面图/数据视图/3D 视图一体化联动，快速高效展示工程信息。
 

（3）用户操作
① 没有菜单，高度图形操作近乎傻瓜化。
（4）二次开发
① 核心代码开源。
② 内嵌 Python 语言开发工具。
③ 提供 C#二次开发接口和范例。
（5）拓展分析工具
① * dll 注册，方便二次开发。
iS3 平台所需的数据较多，包括勘察、设计、施工、监测、运营数据等并且对数据格式 有严格要求，本手册将逐一介绍 iS3 岩石隧道数据准备方法。

1.2 iS3 岩石隧道数据准备总体流程


iS3 岩石隧道数据准备总体流程如图 1.2 所示。首先确定工程信息目录，第二步在信息 目录的基础之上确定信息节点，详见第二章；第三步可以同时进行数据库数据准备、二维数 据准备和三维数据准备，最后将准备好的文件接入 iS3 平台（本手册不介绍接入 iS3 平台的 操作方法）。具体的数据准备操作方法分别见第三、四、五章的内容。

原始数据资料	确定工程信 息目录

 





数据库数据准备




填写数据表格
 







三维数据准备
 
确定信息 节点





三维Revit模型
 









属性附加
 




二维数据准备



CAD图形处理
 

 
三维模型	三维数据库
 
ArcMap数据处 理
 
导入数据库
 
.fbx
 
.odbc
 
属性附加
 
Unity脚本附加	导入数据库

.unity3D
 

平面图/剖面图
 


.tpk
.geodatabase

关联并接入iS3平台



图 1.2   iS3 岩石隧道数据准备总体流程图
 




第二章 确定工程信息目录


岩石隧道工程信息目录是岩石隧道工程数据存储和数据交换的标准，也是对一个岩石隧 道工程涉及到的所有数据分类结果的体现。简单来说，工程信息目录和信息节点规定了哪些 数据需要准备以及数据准备需要遵守的原则。
附录 A 给出了岩石隧道工程信息目录模板以供参考，划分为地理地质、周边环境、设 计、施工和监测五个部分，每个部分分别建立工程信息目录树，其中包括一级目录、二级目 录、三级目录，三级目录下包含多个信息节点。在确定工程信息目录时，针对不同的岩石隧 道工程特性，可以根据工程实际情况删减信息目录和信息节点，筛选出符合工程实际的信息 目录。
根据详勘、设计图纸等原始资料，第六章 6.1 节给出了某隧道案例的工程信息目录和信 息节点，供大家参考。
 




第三章 数据库数据准备


数据库数据准备从填写 Excel 数据表格、导入工程数据库两方面展开。


3.1 填写 Excel 数据表格


附录 B 为岩石隧道工程几张 Excel 数据表格，表格带有字段信息描述，是用于数据存储 和数据交换的模板。每个数据表格由状态（Status）、字段（Heading）、数据单位（Suggested Unit）、数据类型（Suggested Type）、描述（Description）和示例（Example）6 个部分组成， 对工程数据进行了分类，并规定了相应的数据格式。因此，工程信息目录和信息节点确定之 后，需要的数据表格即可确定。
为方便数据录入和导入数据库存储，附录 B 还提供了第二套表格，表格仅包含字段名 称，可直接填入数据。因此，填写工程数据时，按照第一套表格的字段信息描述，在第二套 表格中的相应字段下填写实际的工程数据，完成工程数据的录入工作。

3.2 导入数据库


在所有的工程数据录入 Excel 数据表格之后，将其进一步存储于 iS3 平台所支持的数据 库 Microsoft SQL Server 中。将 Excel 表格中的数据导入数据库的方法详见第六章 6.2 节内容
（以 Microsoft SQL Server2008 为例）。
 




第四章 二维数据准备


在二维数据准备方面，首先对 CAD 图形进行加工处理，然后使用 ArcMap 软件将 CAD 图形对象转化成 GIS 中的点、线、面等要素信息，最后将 GIS 中的所有要素根据实际需求 制作成 TPK 文件和 geodatabase 文件，作为 iS3 平台中二维可视化的底图和可交互的数字化 对象。

4.1 CAD 数据处理


在开始二维数据录入 iS3 平台之前，应准备好勘察、设计、施工等图形数据，这些数据 一般都来源于 CAD 图。为此，首先按勘察、设计、施工、监测和运营维护的顺序将 CAD 图 进行分类整理。CAD 图形的分类整理规则，应按照信息节点的需求单独将一类图形对象保 存成一个 dwg 文件。例如，对于地表水系这个三级目录，由泉点、河流、水库三个信息节点 组成，在整理 CAD 图时，处理成“泉点.dwg”文件、“河流.dwg”文件和“水库.dwg”文件， 每个文件仅有相应的图形对象。
接下来，很重要的工作是将 CAD 图中要处理的图形对象，例如钻孔、地层、水系、监 测点等图形，使其原始的数据格式转换成 ArcGIS 需要的数据格式。例如，设计人员绘图时， 经常使用块等命令绘制一个封闭的平面。因此，为方便后期将此类 CAD 图形导入 ArcGIS 中，应将其转换成闭合多段线。图 4.1 给出了导入 ArcGIS 所需的 CAD 图形对象数据格式。
CAD 图形对象的处理方法可参照第六章 6.3 节的内容。


















图 4.1 图形对象数据格式转换


4.2	ArcGIS 数据处理


在 CAD 图处理好之后，针对需要用平面图或者剖面图显示的信息节点，使用 ArcMap
 

软件（建议使用 10.3 版本）从相应的 CAD 图中提取成点、线、面要素信息，将这些图形对 象置于统一的坐标系下，转换成 Shapefile 格式。
一般情况下，平面图和剖面图各建立一张 ArcMap 地图，地图中的图层与信息节点所需 要的图形相对应。在所有的 CAD 图形对象均转换成 ArcMap 中平面图和剖面图的图层之后， 导出 iS3 平台需要的 TPK 文件和 geodatabase 文件。
(1)	TPK 文件
TPK（Tile Package）是图像格式地图文件，用于数字化工程的地理底图，能快速缩放， 效率高，但不能选择、不能编辑。在岩石隧道二维数据准备阶段，一般将不需要进行数据交 互的图层制作成 TPK 文件，作为工程的地理底图使用。在发布成 TPK 文件时，为方便操作， 其数量不宜过多，一般导出 4-5 个 TPK 文件。
(2)	geodatabase 文件
geodatabase 是一种采用标准关系数据库技术来表现地理信息的数据模型。将需要交互 操作的结构对象（如监测点、工程进度等）从地理底图中独立出来，为其添加属性，实现与 数据库数据的关联，做成 geodatabase 文件，生成 iS3 平台所需要的数字化对象。TPK 文件 和 geodatabase 文件两者配合使用，实现功能的高效统一。
导出 TPK 文件和 geodatabase 文件，操作方法详见第六章 6.3 节内容。
 




第五章 三维数据准备


三维数据准备方面，采用模型与属性信息先分离，后集成的方式，因此分为三维数据库 的导出和三维结构模型的导出两个部分。
利用 BIM 软件建模（如 Revit）得到三维模型之后，为模型构件进行属性附加，即添加 ID，然后将 BIM 软件中的三维结构模型属性信息等直接导出为 ODBC 格式，直接存储于 SQL Server 数据库中。
对于三维结构模型，直接把三维结构模型导出为 FBX 格式，然后利用 Unity 软件对其 添加脚本，再生成 iS3 平台支持的.unity3d 文件。
三维数据库、三维结构模型以及.unity3d 文件导出的方法详见第六章 6.4 节。
 




第六章 某隧道数据准备案例


6.1 案例简介


某隧道总体轴线方向约为 266°-272°，为分离式短隧道，右线隧道最大埋深约 548.0m， 位于 K24+760 处；左线隧道最大埋深约 562.08m，位于 ZK24+740 处。隧道进出口端为山间 冲沟或沟谷，有利于隧址区汇水的排泄，山体植被茂密，以松树为主，隧址区附近人烟稀少， 其特征参数见表 1。
表 6.1 隧道主要参数一览表



起止桩号	设计长度

（m）	进口设计高程

（m）	出口设计高程

（m）
K24+640～K24+921	281	395.96	459.15
ZK24+650～ZK24+939	289	395.93	459.10
工程原始资料见下图（位于文件夹：iS3 培训-2018\2-相关数据\工程原始资料中）。











6.2 确定工程信息目录和信息节点

根据某隧道的勘察文件、CAD 图纸等资料，参照附录 A 的工程信息目录，给出了该隧 道地理地质、周边环境、设计、施工和监测的信息目录和信息节点。
 




表 6.2 某隧道地理地质信息目录

一级目录	二级目录	三级目录	信息节点








工程地质	


地质调绘	气象	气象（WEAT）
		-	地形地貌（GMPG）
		-	地层（STRA）
		地质构造	不良地质（AGEO）
	


地质勘探	

钻探	勘探孔基本信息(HDPH)
			钻孔地层信息（DETL）
			钻孔取芯信息(CORE)
		-	地球物理勘探(GEOE)





















水文地质	地理图	地表水系	河流（RIVR）
	地形	-	等高线（CONT）
	
水文地质勘探	-	钻探（BOHO）
		-	物探（GEPR）
	








原位测试	现场直剪试验	标准贯入试验（SPTR）
		

动力触探	动力触探试验数据
（DPRD）
			动力触探试验（DPRG）
		



地应力测试	水压致裂试验数据
（HFTD）
			水压致裂试验（HFTG）
			水压致裂试验衍生数据
（HFTP）
	







室内试验	

岩矿鉴定	岩矿含量（RMCT）
			岩矿鉴定试验结果
（RMAR）
		

密度实验	相对密度试验（RELD）
			土体密度试验（SDEN）
			岩石密度试验（RDEN）
		吸水率实验	吸水试验（AWAD）
		单轴抗压实验	单轴抗压试验（RUCS）
 

一级目录	二级目录	三级目录	信息节点
		






三轴压缩实验	三轴试验（有效应力）
（TREG）
			三轴试验数据（有效应力）
（TRET）
			三轴试验数据（总应力）
（TRIT）
			三轴试验（总应力）
（TRIG）
		
剪切实验	剪切试验数据（RSHD）
			剪切试验（RSHG）
		抗拉实验	抗拉试验（RTEN）
 



表 6.3 某隧道周边环境信息目录



一级目录	

二级目录	

三级目录	

信息节点




地表水	

-	

-	
地表水源（SWSO）
	

-	

-	
地表水质（SWQU）



地下水	
地下水埋深	

-	
潜水（DOUG）
	

-	

-	
地下水质（GWSO）




植被	

-	

-	
植被种类（PLTY）
	

-	

-	
植被根系（PLRO）



洞渣	
-	
-	
开挖洞渣(TUEG)
	
-	
-	
弃渣场地(WASS)
 




表 6.4 某隧道设计信息目录

阶段	一级目录	二级目录	三级目录	信息节点









方案设计	






隧道总体设计	业主单位	-	业主单位(QWNE)
		设计单位	-	设计单位(DESI)
		施工单位		施工单位（COST）
		监理单位	-	监理单位（MOIN）
		公路等级	-	公路等级（HIGR）
		区域地理位 置	

-	
地理位置描述（LOCA）
	建筑限界与临 空断面	
主洞	-	建筑限界（BULI）
			-	临空断面（INSE）











初步设计	
隧道总体设计	
线型设计	-	隧道桩号坐标（MILE）
			-	沿桩衬砌类型（MILN）
	隧道洞门与洞
口构造物	
洞门	

-	
洞门衬砌（PORT）
	

隧道衬砌	
锚喷支护	-	初喷混凝土（CONC）
			-	锚杆（BOLT）
		二次衬砌	-	二次衬砌（SELI）
	隧道内路基与 路面	
隧道路面	

-	
路面层（TUFA）
	隧道内附属构 造物设计	
预留洞室	
设备洞室	
设备洞室（EQCA）









施工图设 计	

隧道洞门与洞 口构造物	


洞门	-	洞门端墙（PORT）
			-	洞门填筑（BAFI）
			
洞门衬砌	洞门衬砌（GASL）
				衬砌钢筋笼（GARC）
	





隧道衬砌	


锚喷支护	-	初喷混凝土（CONC）
			-	钢筋网（STEL）
			-	工字钢架（JOST）
			-	锚杆（BOLT）
		
二次衬砌	-	二次衬砌（SELI）
			-	二衬钢筋笼（SEST）
 

阶段	一级目录	二级目录	三级目录	信息节点
	


隧道防排水系 统	
防水系统	-	防水板（WEPR）
			-	土工布（GEOT）
		

排水系统	-	环向排水管（CIDR）
			-	横向排水管（LADR）
			-	纵向排水管（VRDI）
	


隧道内路基与 路面	

隧道路面	
路面层	面层（TURO）
				基层（TUFA）
			-	仰拱回填（INBA）
		
面层钢筋	
路面钢筋	路面钢筋设计形式
（ROST）
	
隧道内附属构 造物设计	预留洞室	-	设备洞室（EQCA）
		
电缆管沟	-	电缆沟（CATR）
			-	排水沟（CWDI）
 

表 6.5 某隧道施工信息目录

一级目录	二级目录	三级目录	信息节点
超前地质预 报	
地球物探	

-	
GPR（GPRF）
掌子面地质 素描	掌子面地质素描	-	掌子面地质素描(SKTH)
施工计划与 进度	计划进度	-	计划开挖进度(SCHE)
	实际进度	-	实际开挖进度(ACHE)










施工方案与 参数	


开挖	-	方案（ES）
		-	三台阶开挖参数（EPS）
		-	二台阶开挖参数（EPE）
	初期支护方案与 参数	

-	
方案（ISP）
	二次支护方案与
参数	

-	
方案（SSP）
	超前支护方案与 参数	

-	
方案（ASP）
	注浆施工方案与
参数	

-	
方案（GCS）





施工质量	初衬施工质量	-	初衬施工质量（ILCQ）
	二衬施工质量	-	二衬施工质量（SLCQ）
	注浆施工质量	-	注浆施工质量（GQ）
	锚杆施工质量	-	锚杆施工质量（ARCQ）
	隧道路面质量	-	隧道路面质量（TPQ）
施工变更	-	-	围岩变更（CHAG）
 

表 6.6 某隧道监测信息目录

一级目录	二级目录	三级目录	信息节点









必测项目	地质及支护状态观察	
-	观察记录（MONI）
	


地表下沉	
-	
测线数据（MONL）
		
-	预警值（WARA）
	

拱顶下沉	
-	测线数据（MONL）
		
-	预警值（WARA）
	

洞内收敛	
-	测线数据（MONL）
		
-	预警值（WARA）





选测项目	围岩体内位移	洞内测试	测线数据（MONL）
	钢支撑内力	
-	测点数据（MONP）
	锚杆轴力	
-	测点数据（MONP）
	衬砌内力	
-	测点数据（MONP）
 

6.2 填写数据表格并导入数据库


（1）填写数据
以附录 B 提供的第一套数据表格为模板，在第二套数据表格里填入工程数据，本案例 共填写 3 个表格供大家参考（表格位于文件夹：Course3-iS3 数据库数据准备/数据表格样例
（只含数据）中）。
（2）导入数据库
打开 SQL Server 2008，右键选择“数据库”---“新建数据库”---数据库名称输入 “TunnelDemo”---“确定”。



















右键选择“TunnelDemo”---“任务”--- “导入数据”。


























选择“下一步”。
 
































在“数据源”选项中选择源文件类型---选择“Microsoft Excel”。



























点击“浏览”，选择需要导入数据的 Excel 文件“数据表格样例（只含数据）”---点击“下 一步”。
 
































输入服务器名称“127.0.0.1”---选择数据库“TunnelDemo”，点击“下一步”。





























选择“下一步”。
 































勾选 3 个数据表格---点击“下一步”。





























选择“立即运行”---点击“下一步”。
 
































点击“完成”。

































执行成功，点击“关闭”。
 
































点击“数据库”---点击“TunnelDemo”---点击“表”，可以找到导入的数据表格。



























右键选择导入的表格，选择“重命名”---删除后面的字符“ ”。
 














































导出脚本文件。右键点击“TunnelDemo”---“任务”---“生成脚本”。
 
































点击“下一步”。
































选择数据库“TunnelDemo”---勾选“为所选数据库中的所有对象填写脚本”---点击“下 一步”。
 
































选择“表/视图选项”下的“编写数据的脚本”---改为“TRUE”---点击“下一步”。





























点击“将脚本保存到文件”---点击“浏览”为生成的脚本文件添加保存路径---选择文件 夹“Course3-iS3 数据库数据准备/结果文件”---文件名输入“TunnelDemo”---点击“保存”
 

---点击“确定”。





















































点击“完成”。
 
































成功生成脚本，点击“关闭”。
































打开文件夹“Course3-iS3 数据库数据准备/结果文件”，可以找到导出的脚本文件。
 




















 
 




6.3 二维数据准备


（1）制作平面图
1)	CAD 处理
打开文件 “线路平面图.dwg”。






















选中河流图形对象，按住 Ctrl+C 键复制。






















新建 CAD 空白文件---保存为“River.dwg”---右键空白处，选择“剪贴板”---“粘贴到 原坐标”（双击鼠标滚轮，图形显示在视野中央）---“保存”到过程文件/二维数据/CAD 图/ 平面图文件夹中。
 
























同 理 ， 选 中隧 道 图形 对象 ， 按住 Ctrl+C 键 复 制， 新 建 CAD 空白 文 件 ---保存为 “TunnelPlan.dwg”---右键空白处，选择“剪贴板”---“粘贴到原坐标”---“保存”至过程 文件/二维数据/CAD 图/平面图文件夹中。





















同理，选中监测点图形对象，按住 Ctrl+C 键复制，新建 CAD 空白文件---保存为 “MonPoint.dwg”---右键空白处，选择“剪贴板”---“粘贴到原坐标”---“保存”到“Course4- iS3 二维数据准备/CAD 平面图”文件夹中。
 
























此时的监测点是用“c”命令绘制的，由于我们想将监测点转化成 GIS 的 Point 要素， 应输入“point”命令在监测点处画“点”，为方便看到绘制的点应设置点样式。





















删除原始的“圆”图形对象。
 
























打开文件夹：Course4-iS3 二维数据准备/CAD 平面图，可以看到处理好的 CAD 图形对 象。






2)	CAD 数据导出为 ArcMap 图层。
打开 ArcaMap10.3，选择“空白地图”---“确定”。






















点击 ，输入文件名“隧道平面图”---“保存”。
 




























点击右侧的	，选择文件夹“Course4-iS3 二维数据准备”---“确定”，将文件 夹接入 ArcMap 中。




























为图层设置坐标系。右键“图层”---“属性”---“坐标系”---选择“WGS 1984 Web Mercator(auxiliary sphere)”---“确定”。
 


































为 CAD 图形设置统一坐标系。点击	，在右侧的目录下点击“MonPoint.dwg”，右键 选择“属性”---“编辑”---“”选择“WGS 1984 Web Mercator(auxiliary sphere)”---“确定”
---再“确定”。
 


























导出 CAD 图形对象。打开右侧目录下的“MonPoint.dwg”---左键选中“Point”---拖入 中间的窗口显示。
























导出图层。选择左侧图层“MonPoint.dwg Point”---右键选择“数据”---“导出数据”-
--选择 ，保存名称为“MonPoint”，保存类型为“Shapefile”---“保存”---“确定”---询问 是否将导出的数据添加到地图图层中，选择“是”。
 



















































删除 CAD 数据。选择左侧图层“MonPoint.dwg Point”---右键选择“移除”。















同理，点击	，在右侧的目录下点击“River.dwg”，右键选择“属性”---“编辑”---“”
 

选择“WGS 1984 Web Mercator(auxiliary sphere)”---“确定”---再“确定”。
 





















同理，打开右侧目录下的“River.dwg”---左键选中“Polyline”---拖入中间的窗口显示。






















同理，选择左侧图层“River.dwg Polyline”---右键选择“数据”---“导出数据”---选择
 

 ，保存名称为“隧道”，保存类型为“Shapefile”---“保存”---“确定”---询问是否将导 出的数据添加到地图图层中，选择“是”。


















































同理，选择左侧图层“River.dwg Polyline”---右键选择“移除”。
 
 

同理，点击	，在右侧的目录下点击“TunnelPlan.dwg”，右键选择“属性”---“编辑”
---“”选择“WGS 1984 Web Mercator(auxiliary sphere)”---“确定”---再“确定”。











































同理，打开右侧目录下的“TunnelPlan.dwg”---左键选中“Polyline”---拖入中间的窗口 显示。
 
























同理，选择左侧图层“TunnelPlan.dwg Polyline”---右键选择“数据”---“导出数据”--
-选择	，保存名称为“TunnelPlan”，保存类型为“Shapefile”---“保存”---“确定”---询 问是否将导出的数据添加到地图图层中，选择“是”。
























 
 

 

同理，选择左侧图层“TunnelPlan.dwg Polyline”---右键选择“移除”。




















为与 River 图层区分开，将 TunnelPlan 换一个颜色显示。点击左侧图层“TunnelPlan” 下方的“	”标志---选择“颜色”---点击“确定”。





















选择“自定义”---“ArcMap 选项”---选择“共享”---勾选“ArcGIS Runtime 工具”。
 
































选择“文件”---“地图文档属性”---填写“文件、标题、摘要、描述、作者、制作者名 单、标签和超链接基础地址”（必填项，内容不限，可填 1）---“确定”。



























2) 生成 TPK 文件 勾选需要生成底图的图层，此处选择“TunnelPlan”和“River”。
 
























选择“文件”---“共享为”---“切片包”


























选择保存路径 为“Course4-iS3 二维数据准备/结果文件”---保存为“隧道平面图”-
--“保存”。
 


































选择“切片格式”---最高细节层次处滑块拖至“18”（可根据需要自行设置）---点击右 上角“共享”。






























询问创建切片包前是否保存，选择“是”---已成功创建切片包，点击“确定”。
 

 













3) 创建数字化对象，生成 geodatabase 文件
添加字段。勾选“MonPoint”图层---右键选择“MonPoint”图层---“打开属性表”---选 择                                                                                “表选项”---“添加字段”---输入名称“ID”、类型“短整型”---“确定”。
 




























































点击“编辑器工具条” ---选择“编辑器”---“开始编辑”---在 ID 中输入“1、2、3、
4、5、6” ---选择“编辑器”---“保存编辑内容”---“停止编辑”。
 

 

















































选择“文件”---“共享为”“ArcGIS Runtime      内容”---点击 ，选择保存地址---询问在
 

创建 ArcGIS Runtime  内容前是否保存，点击“是”---成功创建 ArcGIS Runtime  内容，点击 “确定”。
 

 

（3）制作剖面图
1)	CAD 处理
打开文件 “左幅隧道纵断面图.dwg”。






















选中隧道图形对象，按住 Ctrl+C 键复制。
 

新建 CAD 空白文件---保存为“TunnelSection.dwg”---右键空白处，选择“剪贴板”--- “粘贴到原坐标”（双击鼠标滚轮，图形显示在视野中央）---“保存”至 Course4-iS3 二维数 据准备/原始文件/CAD 剖面图文件夹中。





















同 理 ， 选 中地 层 图形 对象 ， 按住 Ctrl+C 键复制---新建 CAD 空白文件 ---保存为 “Stratum.dwg”---右键空白处，选择“剪贴板”---“粘贴到原坐标”---“保存”至 Course4- iS3 二维数据准备/原始文件/CAD 剖面图文件夹中。





















选中中间的地层图形（此时的地层图形为“线”，为方便导入成 ArcMap 中的 Polygon
要素，在此处进行如下处理）：
 
























输入“j”---回车，将直线转换成多段线。






















同理，对左右两侧的地层图形进行上述处理，均转换为闭合的多段线。
 
















































打开文件夹：Course4-iS3 二维数据准备/原始文件/CAD 剖面图，可以看到处理好的 CAD
图形对象。







2)	CAD 数据导出为 ArcMap 图层。
打开 ArcaMap10.3，选择“空白地图”---“打开”。
 
























点击	---选择文件夹：Course4-iS3 二维数据准备/过程文件/ArcMap 剖面图---输入文 件名“隧道剖面图”---点击“保存”。






























为图层设置坐标系。右键“图层”---“属性”---“坐标系”---选择“WGS 1984 Web Mercator(auxiliary sphere)”---“确定”。
 


































为 CAD 图形设置统一坐标系。点击目录 ，在右侧的目录下点击“Stratum.dwg”，右 键选择“属性”---“编辑”---“”选择“WGS 1984 Web Mercator(auxiliary sphere)”---“确 定”---再“确定”。
 


























导出 CAD 图形对象。打开右侧目录下的“Stratum.dwg”---左键选中“Polygon”---拖入 中间的窗口显示。
























导出图层。选择左侧图层“Stratum.dwg Polygon”---右键选择“数据”---“导出数据”
---选择 ，保存名称为“Stratum”，保存类型为“Shapefile”---“保存”---“确定”---询问 是否将导出的数据添加到地图图层中，选择“是”。
 
























































删除 CAD 数据。选择左侧图层“Stratum.dwg Polygon”---右键选择“移除”。
 
























为“Stratum”图层面元设置不同的颜色（一种颜色代表一种地层）。
右键“Stratum”---选择“打开属性表”---选中“FID_”列---右键选择“字段计算器”-
--选择“是”---在输入框中输入“[FID+1]”---“确定”。
 








































右键“Stratum”---选择“属性”---选择“符号系统”---左侧选择“类别”---“添加所有
值”---双击“值 1、2、3”左边的颜色框，为图层选择颜色---“确定”---再“确定”。
 

 

同理，点击目录	，在右侧的目录下点击“TunnelSection.dwg”，右键选择“属性”--- “编辑”---“”选择“WGS 1984 Web Mercator(auxiliary sphere)”---“确定”---再“确定”。




























同理，打开右侧目录下的“TunnelSection.dwg”---左键选中“Polyline”---拖入中间的窗 口显示。
























同理，选择左侧图层“TunnelSection.dwg Polyline”---右键选择“数据”---“导出数据”
---选择 ，保存名称为“TunnelSection”，保存类型为“Shapefile”---“保存”---“确定”
---询问是否将导出的数据添加到地图图层中，选择“是”。
 



























































同理，选择左侧图层“隧道.dwg Polyline”---右键选择“移除”。
 





















选择“自定义”---“ArcMap 选项”---选择“共享”---勾选“ArcGIS Runtime 工具”。





























选择“文件”---“地图文档属性”---填写“文件、标题、摘要、描述、作者、制作者名 单、标签和超链接基础地址”（必填项，内容不限，可均填 1）---“确定”。
 
































2) 生成 TPK 文件
选择“文件”---“共享为”---“切片包”。



























选择 ---保存为“隧道剖面图”---“保存”。
 
































选择“切片格式”---最高细节层次处滑块保持“20”不变（可根据需要自行设置）---点 击右上角“共享”。






























询问创建切片包前是否保存，选择“是”---已成功创建切片包，点击“确定”。
 

 















3) 创建数字化对象，生成 geodatabase 文件
添加字段。右键选择“Stratum”图层---“打开属性表”---选择“表选项”	---“添加
字段”---输入名称“ID”、类型“短整型”---“确定”。
 











































点击“编辑器工具条” ---选择“编辑器”---“开始编辑”---在 ID 中输入“1、2、3”
---选择“编辑器”---“保存编辑内容”---“停止编辑”。
 






















































选择“文件”---“共享为”“ArcGIS Runtime 内容”---点击 ，选择保存地址---询问在 创建 ArcGIS Runtime 内容前是否保存，点击“是”---成功创建 ArcGIS Runtime 内容，点击 “确定”。
 

 

 





 
 




6.4 三维数据准备


（1）导出 ODBC 数据库
打开“3D TunnelDemo model .rvt”文件---选择“管理”---“项目参数”。






















选择“添加”---名称栏输入“ObjID”---参数类型选择“整数”---点击“选择全部”--- 点击“确定”。
 

选择“添加”---名称栏输入“iS3type”---参数类型选择“文字”---点击“选择全部”--
-点击“确定”。

























点击监测点对象，在左侧的属性浏览器中的 ObjID 输入对应的 ID：1、2、3、4、5、6； 且在 6 个监测点的 iS3type 中均输入“MonPoint”。
 
























同理，选中衬砌对象，在左侧的属性浏览器中的 ObjID 中输入对应 ID：1、2、3；iS3type 中输入“SecondaryLiningV” “SecondaryLiningIV” “SecondaryLiningV”（分别对应 ID1、 2、3）。





















点击“导出”---“ODBC 数据库”。
 




























打开 SQL Server 2008，新建数据库取名为 “Revitout”，作为 Revit 数据库导出的载体。
 




























点击“新建”。
































选择“SQL Server Native Client10.0”---点击“下一步”
 




























创建新数据源，输入“Revitout”。

























点击“下一步”---点击“完成”
 





























在 Description（描述）中输入“Revitout”---Server（服务器）中输入本机 IP“127.0.0.1”
---点击---“下一步”。



























点击“下一步”。
 































勾选 Change the default database to（更改数据库）---选择“Revitout”---点击“下一步”。



























点击“完成”。
 





























点击“OK”。





























点击“确定”。
 
































点击“OK”---点击“确定”
































打开 SQL Server 2008---选择“Revitout”---“表”，可以发现 Revit 数据已经导出。
 





















右键数据库“Revitout”---点击“任务”---“生成脚本”。























点击“下一步”。
 





























选择数据库“Revitout”---勾选“为所选数据库中的所有对象填写脚本”---点击“下一 步”。




























选择“表/视图选项”下的“编写数据的脚本”---改为“TRUE”---点击“下一步”。
 





























点击“将脚本保存到文件”---选择“浏览”为脚本文件添加保存路径---选择文件夹 “Course5-iS3 三维数据准备/结果文件”---文件名输入“Revitout”---点击“保存”---点击“确 定”。
 




























点击“完成”。





























成功生成脚本---点击“关闭”。
 





























（2）导出 FBX 格式文件
打开“3D TunnelDemo model .rvt”文件---“导出”---“FBX”。
































保存到文件夹“Course5-iS3 三维数据准备/过程文件”中。
 





























（3）生成.unity3D 文件
打开 Unity 软件，点击“Create project”新建 Unity 工程。




















右键 Assets---选择 “Import Package ”---“Custom Package…”---导入 iS3 Unity 开发包 “iS3UnityPackageV1.1.unitypackage”（位于 Course5-iS3 三维数据准备/帮助文件）---点击 “Import”。
 











































右键 Assets---选择“Import New Asset”---导入 Revit 三维模型文件 FBX。
 

 

将模型拖拽到窗口显示区，即可将模型添加到场景中。





















添 加 漫 游 脚 本 ： 在 Hierarchy  窗 口 中 选 择 “Main Camera”--- 点击菜单 “Tools”---“1-
ProcessView”，即可添加漫游脚本。















添加图层：在 Hierarchy 窗口中选择“Main Camera”---在右侧 inspector 窗口点击“Layer”
---“Default”---“Add Layer”---并在 Layer8  处，输入“UnityLayer”。
 





































处 理 模 型 目 录 ： 在 Hierarchy  窗 口 中 选 择 导 入 的 模 型 --- 点 击 菜 单 “Tools ” --- “ 2-
ProcessCatalog”，即可对模型目录结构进行处理。
















添加点选脚本： 在 Hierarchy 窗口中选择需要点选交互的目录结构---点击菜单“Tools”
---“3-ProcessHighLight”，即可对模型添加交互脚本。
 

 


























 
导出 Unity3d 文件：点击“File”--“-
 
Build Settings”---选择 Web Player 格式---点击 Build-
 
--选择文件夹“Course5-iS3 三维数据准备/结果文件”。



































导出成功，打开文件夹“Course5-iS3  三维数据准备/结果文件”，可以在目录中找
 

到.unity3d 文件。

















 
 




附 录


附录 A	工程信息目录


地理地质
一级目录	二级目录	三级目录	信息节点















工程地质	










地质调绘	气象	气象（WEAT）
		

遥感	航空航片信息（AERP）
			遥感信息解译（IRSI）
		-	地形地貌（GMPG）
		-	地层（STRA）
		



地质构造	断层（FALT）
			褶皱（FOLD）
			裂隙（JONT）
			不良地质（AGEO）
		-	特殊性岩土（SPEC）
	



地质勘探	


钻探	勘探孔基本信息(HDPH)
			钻孔地层信息（DETL）
			钻孔取芯信息（CORE）
		-	地球物理勘探(GEOE)














水文地质	





地理图	


地表水系	泉点（SPPO）
			河流（RIVR）
			水库（RSVR）
		-	水文地质单元（HYUN）
		-	水化学数据采样（HYCH）
		-	水源保护区（WSPA）
	





影像图	



隧道 DEM	隧址区 DEM（TDEM）
			研究区 DEM（SDEM）
			地理空间数据云 DEM
（CDEM）
		

卫星图	隧址区卫星图（TSAT）
			研究区卫星图（SSAT）
	地形	-	等高线（CONT）
 

一级目录	二级目录	三级目录	信息节点
		-	分水岭（WASH）
	

水文地质勘探	-	钻探（BOHO）
		-	物探（GEPR）
	


水文地质试验	-	抽水试验（PUTR）
		-	压水试验（HFTR）
		-	注水试验（WITR）





























岩土体测试	



























原位测试	

载荷板试验	载荷板试验数据（PLTT）
			载荷板试验（PLTG）
		





现场直剪试验	现场直剪试验数据

（FDSD）
			现场直剪试验（FDST）
			十字板剪切试验数据

（VANE）
			标准贯入试验（SPTR）
		


动力触探	动力触探试验数据

（DPRD）
			动力触探试验（DPRG）
		


静力触探	静力触探试验数据

（SCPD）
			静力触探试验（SCPG）
		

旁压试验	旁压试验数据（PMTD）
			旁压试验（PMTG）
		



扁铲侧胀试验	侧胀试验衍生参数

（DMTP）
			侧胀试验数据（DMTT）
			侧胀试验（DMTG）
		




地应力测试	水压致裂试验数据

（HFTD）
			水压致裂试验（HFTG）
			水压致裂试验衍生数据

（HFTP）
	室内试验	岩矿鉴定	岩矿含量（RMCT）
 

一级目录	二级目录	三级目录	信息节点
			岩矿鉴定试验结果

（RMAR）
		


密度实验	相对密度试验（RELD）
			土体密度试验（SDEN）
			岩石密度试验（RDEN）
		吸水率实验	吸水试验（AWAD）
		耐崩解性实验	耐崩解性试验（DISR）
		膨胀实验	膨胀试验（EXPA）
		冻融实验	冻融试验（FREZ）
		单轴抗压实验	单轴抗压试验（RUCS）
		







三轴压缩实验	三轴试验（有效应力）

（TREG）
			三轴试验数据（有效应力）

（TRET）
			三轴试验数据（总应力）

（TRIT）
			三轴试验（总应力）

（TRIG）
		

剪切实验	剪切试验数据（RSHD）
			剪切试验（RSHG）
		抗拉实验	抗拉试验（RTEN）
 

周边环境
一级目录	二级目录	三级目录	信息节点


周边建筑物	-	-	既有工程（EXPR）
	-	-	重要建筑物（IMAR）


地表水	-	-	地表水源（SWSO）
	-	-	地表水质（SWQU）



地下水	

地下水埋深	-	潜水（DOUG）
		-	承压水（DOCG）
	-	-	地下水质（GWSO）


植被	-	-	植被种类（PLTY）
	-	-	植被根系（PLRO）


洞渣	-	-	开挖洞渣(TUEG)
	-	-	弃渣场地(WASS)
 

设计
阶段	一级目录	二级目录	三级目录	信息节点











方案设计	





隧道总体设计	业主单位	-	业主单位(QWNE)
		设计单位	-	设计单位(DESI)
		施工单位		施工单位（COST）
		监理单位	-	监理单位（MOIN）
		公路等级	-	公路等级（HIGR）
		区域地理位置	-	地理位置描述（LOCA）
	


建筑限界与临空 断面	

主洞	-	建筑限界（BULI）
			-	临空断面（INSE）
		

斜井	-	建筑限界（BULI）
			-	临空断面（INSE）




















初步设计	

隧道总体设计	

线型设计	-	隧道桩号坐标（MILE）
			-	沿桩衬砌类型（MILN）
	隧道洞门与洞口 构造物	洞门	-	洞门衬砌（PORT）
		明洞工程	-	明洞衬砌（GALL）
	


隧道衬砌	

锚喷支护	-	初喷混凝土（CONC）
			-	锚杆（BOLT）
		二次衬砌	-	二次衬砌（SELI）
	隧道内路基与路 面	

隧道路面	

-	

路面层（TUFA）
	

隧道通风构造物 与施工辅助通道 设计	斜井	-	斜井衬砌（INLI）
		

风口	-	联络风道（COAI）
			-	送风口（TUYE）
		紧急停车带	-	紧急停车带（EMST）
	



隧道内附属构造 物设计	



横通道	

车行横通道	普通段（TRAC）
				加强段（TRAF）
			

人行横通道	普通段（TRAC）
				加强段（TRAF）
		预留洞室	设备洞室	设备洞室（EQCA）




施工图设计	


隧道洞门与洞口 构造物	



洞门	-	洞门端墙（PORT）
			-	洞门填筑（BAFI）
			

洞门衬砌	洞门衬砌（GASL）
				衬砌钢筋笼（GARC）
 

阶段	一级目录	二级目录	三级目录	信息节点
		


明洞工程	

明洞衬砌	明洞衬砌（GALL）
				衬砌钢筋笼（GARC）
			-	明洞回填（BAFI）
		

洞门段超前支 护	

套拱	套拱衬砌（TURA）
				套拱钢架（TUAR）
			-	导向钢管（GUSP）
	隧道辅助施工措 施	

超前支护	-	超前小导管（LECO）
			-	管棚支护（TUSH）
	






隧道衬砌	




锚喷支护	-	初喷混凝土（CONC）
			-	钢筋网（STEL）
			-	工字钢架（JOST）
			-	钢格栅（GRST）
			-	锚杆（BOLT）
		

二次衬砌	-	二次衬砌（SELI）
			-	二衬钢筋笼（SEST）
	




隧道防排水系统	

防水系统	-	防水板（WEPR）
			-	土工布（GEOT）
		


排水系统	-	环向排水管（CIDR）
			-	横向排水管（LADR）
			-	纵向排水管（VRDI）
	


隧道内路基与路 面	


隧道路面	

路面层	面层（TURO）
				基层（TUFA）
			-	仰拱回填（INBA）
		面层钢筋	路面钢筋	路面钢筋设计形式（ROST）
	




隧道通风构造物 与施工辅助通道 设计	


斜井	

斜井衬砌	洞门衬砌（PORT）
				井身衬砌（INLI）
			-	接头(INSP)
		


竖井	

竖井衬砌	锁口圈（SIWE）
				井身衬砌(SILO)
			-	接头（SISP）
		紧急停车带	封堵墙	封堵墙（BLWA）
	隧道内附属构造 物设计	车行横通道	-	接头衬砌（CORS）
		人行横通道	-	接头衬砌（CORS）
 

阶段	一级目录	二级目录	三级目录	信息节点
		预留洞室	-	设备洞室（EQCA）
		

电缆管沟	-	电缆沟（CATR）
			-	排水沟（CWDI）











 
 



施工
一级目录	二级目录	三级目录	信息节点


超前地质预 报	

地球物探	-	GPR（GPRF）
		-	TSP（TSPF）
	-	-	超前钻探（AD）
掌子面地质 素描	

掌子面地质素描	

-	

掌子面地质素描(SKTH)
施工计划与 进度	计划进度	-	计划开挖进度(SCHE)
	实际进度	-	实际开挖进度(ACHE)










施工方案与 参数	





开挖	-	方案（ES）
		-	三台阶开挖参数（EPS）
			二台阶开挖参数（EPE）
			CD 法开挖参数（EPCD）
			全断面开挖参数（EPQ）
			预留核心土法开挖参数（EPY）
	初期支护方案与参数	-	方案（ISP）
	二次支护方案与参数	-	方案（SSP）
	超前支护方案与参数	-	方案（ASP）
	注浆施工方案与参数	-	方案（GCS）





施工质量	初衬施工质量	-	初衬施工质量（ILCQ）
	二衬施工质量	-	二衬施工质量（SLCQ）
	注浆施工质量	-	注浆施工质量（GQ）
	锚杆施工质量	-	锚杆施工质量（ARCQ）
	隧道路面质量	-	隧道路面质量（TPQ）
施工变更	-	-	围岩变更（CHAG）
 



监测
一级目录	二级目录	三级目录	信息节点







必测项目	地质及支护状态观察	-	观察记录（MONI）
	

地表下沉	-	测线数据（MONL）
		-	预警值（WAVA）
	

拱顶下沉	-	测线数据（MONL）
		-	预警值（WAVA）
	

洞内收敛	-	测线数据（MONL）
		-	预警值（WAVA）











选测项目	围岩弹性波测试		测点数据（MONP）
	

围岩体内位移	地表测试	测线数据（MONL）
		洞内测试	测线数据（MONL）
	围岩与初衬接触压力	-	测点数据（MONP）
	初衬与二衬接触压力	-	测点数据（MONP）
	钢支撑内力	-	测点数据（MONP）
	锚杆轴力	-	测点数据（MONP）
	支护衬砌表面裂缝	-	测点数据（MONP）
	支护背后密实度监测	-	测点数据（MONP）
	衬砌内力	-	测点数据（MONP）
 




附录 B	数据表格


表 B.1-1	STRA – 地层基本信息（字段信息描述）
Group Name: STRA – Stratum Descriptions
组名：STRA –  地层基本信息
状态

Status	

*											
字段

Heading	

ID	

STRA_NAME	

STRA_GEO1	

STRA_GEO2	

STRA_STAT	

STRA_WEA	

STRA_BTBC	

STRA_DSRG	

STRA_DIP	

STRA_DIR	

STRA_DESC	

FILE_FSET
数据单位
Suggested Unit							


kPa		


deg	


deg		
数据类型
Suggested Type	


X	


X	


PA	


X	


X	


X	


0DP	


X	


1DP	


1DP	


X	


X

描述	数字化	


地层名	


地层年代	


地层岩性	
地层记录代	


风化程度	
承载力基本容许值	
地层分布范	


倾向	


倾角	


地层总体描述	
关联文件索
												
	对象编											
Description					码或编号		[f/a0]	围				引
	号											
示例

Example												

表 B.1-2	STRA – 地层基本信息（直接填入数据）
ID	STRA_NAME	STRA_GEO1	STRA_GEO2	STRA_STAT	STRA_WEA	STRA_BTBC	STRA_DSRG	STRA_DIP	STRA_DIR	STRA_DESC	FILE_FSET
											
											
 



表 B.2-1	SELI – 二次衬砌（字段信息描述）
roup Name: SELI – Secondary Lining
组名：SELI –  二次衬砌
状态

Status	

*													
字段

Heading	

ID	LINE_T

YPE	INVE_Y

N	SELI_TYP

E	TOP_RAD

I	TOP_ANG

L	ARSP_RAD

I	ARSP_ANG

L	INVE_RAD

I	INVE_ANG

L	TOP_THI

C	SIDE_THI

C	INVE_THI

C	INVE_TYP

E
数据单位
Suggested Unit					


mm	


deg	


mm	


deg	


m	


deg	


mm	


mm	


m	
数据类型
Suggested Type	


X	


X	


YN	


X	


INT	


0DP	


INT	


0DP	


INT	


0DP	


INT	


INT	


INT	


X

描述	数字化	
衬砌类	
是否设置	
二衬混凝	
拱顶二衬	
拱顶二衬	
拱脚二衬内	
拱脚二衬圆	
仰拱二衬内	
仰拱二衬圆	
拱顶二衬	
侧墙二衬	

仰拱厚度	
仰拱混凝土
														
	对象编													
Description		型	仰拱	土型号	内半径	圆心角	半径	心角	半径	心角	厚度	厚度		型号
	号													
示例

Example														



表 B.2-2	SELI – 二次衬砌（直接填入数据）


ID	LINE_T YPE	

INVE_YN	

SELI_TYPE	

TOP_RADI	

TOP_ANGL	

ARSP_RADI	

ARSP_ANGL	

INVE_RADI	

INVE_ANGL	

TOP_THIC	

SIDE_THIC	

INVE_THIC	

INVE_TYPE
													
													
 



表 B.3-1	MONP - 测点数据（字段信息描述）
Group Name: MONP – Monitoring Point
组名：MONP – 测点数据
状态

Status	

*									
字段

Heading	

ID	

NAME	

time	

component	

value	

unit	

instrumentDetail	

Rate	

contractor	

remarks
数据单位

Suggested Unit			

yyyy.mm.dd							
数据类型

Suggested Type	

ID	

X	

DT	

X	

2DP	

X	

X	

X	

X	
描述

Description	数字化对象编 号	

监测点名称	
监测时间	
监测内容	
监测读数	
监测数据单位	

监测仪器	
监测频率描述	
监测仪器操作人员	

备注
示例 Example										


表 B.3-2	MONP - 测点数据（直接填入数据）

ID	
NAME	
time	
component	
value	
unit	
instrumentDetail	
Rate	
contractor	
remarks
									
									
 




附录 C	数据准备需要安装的软件


（1） SQL Server 2008
（2） AutoCAD 2010 以上版本
（3） ArcGIS 10.3 版本
（4） Autodeak Revit 2016
（5） Unity 5.3 版本 可从下方提供的百度云地址下载上述软件： 地址：https://pan.baidu.com/s/13u2mzuLzLWn0BVwQCkRNVw; 密码：wisp
 




附录 D	岩石隧道 Revit 建模方法


1. 初衬族建模方法
对初衬和二衬的 CAD 图纸进行处理，图纸中的尺寸单位为毫米，比例为 1:1，将衬砌中心放置 于 CAD 图中原点处，如图所示。





















打开 Revit 软件---新建族---选择公制常规模型，如图所示






















打开页面后显示楼层平面视图，在左下角项目浏览器中将视图切换至前立面图，通过点击工具 栏中插入---导入 CAD---选择衬砌图纸所在的文件，将包含内衬与初衬的 CAD 图导入，图中内层轮 廓为二衬内轮廓，中间轮廓为二衬外轮廓，同是也是初衬内轮廓，外层轮廓为初衬外轮廓。在建立 初衬模型是，二衬内轮廓的作用是方便对初衬厚度进行标注。
 
























由于要对衬砌厚度进行尺寸标注，需要建立参考平面。点击创建---参照平面，在图中二衬内侧 轮廓中的关键点处（各弧线中点处、弧线与弧线相连处）绘制相切于弧线的参照平面，以及初衬拱 脚水平线处绘制水平的参照平面，如图所示。绘制切线可按照如下方法：(a) 事先在 cad 中将关键点 与弧线圆心连接，并导入到 Revit 中；(b) 在 Revit 中选中衬砌模型，将其完全分解；(c) 点击创建-
-参照平面，拾取 cad 中关键点与圆心连接的直线作为参照平面，并将 cad 中原有的直线删除；(d) 选 中绘制的参照平面，旋转 90°即可得到该弧线的切线。























在项目浏览器中将视图切换至楼层平面---参照标高，点击创建---放样---绘制路径，在锁定的参 照平面中绘制一条长度为 5000 的放样路径，并点击与参照平面的锁定图标，将其位置锁定。
 
























点击图中“5000”旁的标注图标	或点击上方对齐尺寸标注	，将放样路径的长度添加 标注，确认后选择标注线，点击上方标签下拉菜单，选择添加参数。
























在弹出属性框中的名称栏中输入：隧道单元长度，点击确定，添加参数。
 























完成后在尺寸标注处出现参数名称，点击旁边的小锁图标，将参数锁定。至此，实现了衬砌单 元长度的参数化。
























点击	图标，完成放样路径编辑。之后点击选择轮廓---编辑轮廓，	，选择前立面图编 辑初衬轮廓。点击拾取线按钮 ，并依次点击初衬的内外侧轮廓线，点击后的线变为粉色，如图所
示。
 
























接下来，添加标注。由于初衬的内轮廓大小与内衬厚度有关，因此首先标注内衬厚度尺寸。点 击对齐标注尺寸 ，添加参照平面与初衬内轮廓距离的尺寸标注。标注位置包括：内衬内轮廓弧 线中点处的参照平面与初衬内侧弧线中点的距离、弧线交点处参照平面与相交两弧线的距离。多次 标注的目的是在修改尺寸参数时保证衬砌轮廓均匀变形，防止出现畸变。同样通过标签，添加参数， 输入参数名称为主洞二衬厚度，完成后点击锁定按钮，完成内衬厚度的参数化。如图所示。






















添加外轮廓标注。同样利用水平标注尺寸，添加参照平面与外轮廓距离的尺寸标注。由于初衬 拱脚处衬砌厚度变化不均匀，标注位置需避开拱脚处，仅对拱顶与仰拱弧线中点处、拱顶与拱墙弧 线接头处添加标注。同样通过标签，添加参数，输入参数名称为外轮廓，完成后点击锁定按钮，完 成初衬外轮廓参数化。如图所示。
 
























删除两侧拱脚处横线，重新绘制。绘制后点击锁定按钮将其与水平参照平面锁定，固定拱脚位 置。
























完成放样。断面轮廓绘制完成后点击两次对勾按钮	，完成放样。切换至三维视图可查看效 果。
 























修改参数。点击右上角族类型	，打开对话框，点击添加参数	，输入参数名称为喷射 混凝土厚度，另外，在族类型对话框中的外轮廓参数右边公示栏内输入“主洞二衬厚度+喷射混凝土 厚度”，如图。外轮廓可由主洞二衬厚度与喷射混凝土厚度相加得到，输入参数时只需输入该两项即 可。修改主洞二衬厚度以及喷射混凝土厚度的参数值，观察初衬内外轮廓的变形是否符合设计资料， 如果变形出现扭曲或不对称的情况，需返回步骤 11、12，修改畸变曲线的绘制顺序，遵循内轮廓-外 轮廓弧线-外轮廓拱脚直线段的绘制顺序，并重新添加标注，多次调试至模型能够合理变形。























添 加 材 质 参 数 。 点 击 放 样 完 成 的 初 衬 单 元 模 型 。 在 左 边 属 性 框 中 找 到 材 质 - 默认一栏 
， 点 击 右 边 的 灰 色 小 长 方 形  ， 弹 出 关 联 族 参 数 对 话 框 ， 点 击 添 加 参 数  ，输入参数数据名称为喷射混凝土材质，点击确定。关联参数对话框中出现了新建的 参数名称，选中后点击确定。
 


























选择材质。点击左上角的族类型 ，材质与装饰类别下出现了喷射混凝土材质参数，点击右边 值中的默认，值框中出现包含…的灰色方框 ，点击后出现材质浏览器。点击左边中间的小房子图 标 ，选择 AEC 材质，然后在右边的不同材质框中选择相应的混凝土型号，双击后点击确定。























回到主界面，在三维视图下，点击界面下方工具栏中的视觉样式   ，选择真实        ，即 可 查 看 混 凝 土 材 质 效 果 的 初 衬 模 型 ， 勾 选 左 侧 属 性 栏 中 的 可 将 钢 筋 附 着 到 主 体
，便于在初衬模型中添加钢筋网。至此，该参数化初衬族模型建立完毕。
二衬族建模方法
对二衬的 CAD 图纸进行处理，图纸中的尺寸单位为毫米，比例为 1:1，将衬砌中心放置于 CAD
图中原点处，如图所示。
 


























打开 Revit 软件---新建族---选择公制常规模型，如图所示























打开页面后显示楼层平面视图，在左下角项目浏览器中将视图切换至前立面图，通过点击工具 栏中插入---导入 CAD---选择衬砌图纸所在的文件，导入后截面如图所示。
 


























由于要对衬砌厚度进行尺寸标注，需要建立参考平面。点击创建	---参照平面	，在图 中二衬内侧轮廓中的关键点处（各弧线中点处、弧线与弧线相连处）绘制相切于弧线的参照平面， 如图所示。绘制切线的方法参考初衬建模步骤 4。





















在项目浏览器中将视图切换至楼层平面---参照标高，点击创建 ---放样	---绘制路径
，在锁定的参照平面中绘制一条长度为 5000 的放样路径，并点击与参照平面的锁定图 标	，将其位置锁定。
 


























点击图中“5000”旁的标注图标	或点击上方水平尺寸标注	，将放样路径的长度添加 标注，确认后选择标注线，点击上方标签下拉菜单，选择添加参数。

























在弹出属性框中的名称栏中输入：隧道单元长度，点击确定，添加参数。
 


























完成后在尺寸标注处出现参数名称，点击旁边的小锁图标，将参数锁定。至此，实现了衬砌单 元长度的参数化。

























点击 图标，完成放样路径编辑。之后点击选择轮廓---编辑轮廓，	，选择前立面图编 辑初衬轮廓。点击拾取线按钮 ，并依次点击内衬的内外侧轮廓线，点击后的线变为粉色，如图所
示。
 


























接下来，添加内衬厚度尺寸标注。点击水平标注尺寸 ，添加参照平面与内衬外轮廓距离的 尺寸标注。同样通过标签，添加参数，输入参数名称为主洞二衬厚度，完成后点击锁定按钮，完成 内衬厚度的参数化。如图所示。






















完成放样。断面轮廓绘制完成后点击两次对勾按钮 ，完成放样。切换至三维视图可查看效 果。
 


























添 加 材 质 参 数 。 点 击 放 样 完 成 的 初 衬 单 元 模 型 。 在 左 边 属 性 框 中 找 到 材 质 - 默认一栏 
， 点 击 右 边 的 灰 色 小 长 方 形	， 弹 出 关 联 族 参 数 对 话 框 ， 点 击 添 加 参 数
，输入参数数据名称为二衬-C30 混凝土，点击确定。关联参数对话框中出现了新建的 参数名称，选中后点击确定。



























选择材质。点击左上角的族类型 ，材质与装饰类别下出现了二衬-C30 混凝土参数，点击右 边值中的默认，值框中出现包含…的灰色方框 ，点击后出现材质浏览器。点击左边中间的小房子 图标 ，选择 AEC 材质，然后在右边的不同材质框中选择相应的混凝土型号，双击后点击确定。
 






















































回到主界面，在三维视图下，点击界面下方工具栏中的视觉样式	，选择真实 ，即 可 查 看 混 凝 土 材 质 效 果 的 二 衬 模 型 ， 勾 选 左 侧 属 性 栏 中 的 可 将 钢 筋 附 着 到 主 体
，便于在二衬模型中添加钢筋笼。至此，该参数化二衬族模型建立完毕。
 


























3. 锚杆族建模方法
（1）单个锚杆族模型建模方法
打开 Revit2016，族面板中选择“新建”，在弹出的对话框中点击“公制常规模型”，点击打开， 默认视图为参照标高，保存为“25 中空注浆锚杆”族文件。



















 

创建参照平面。将视图切换到前立面，点击 “创建”选项卡下的“参照平面”，点击“拾取线”  命令，在偏移量中输入 60，点击鼠标左键确定；拖动参照平面的端点，可修改参照平面的长度。
 


















创建杆身模型。选择“创建”选项卡下的放样命令，点击 命令，绘制一条长 2990mm 的直 线，添加“杆身长度”的参数，点击 命令，完成放样路径的编辑。选择编辑轮廓命令，在弹出的 对话框中选择“天花板投影平面”并打开视图；绘制直径分别为 18mm 和 25mm 的圆，并添加如图 所示的参数；连续两次点击  命令，完成放样。































 
 
















































建立锚头模型。点击“创建”选项卡下的“放样融合”命令，点击绘制路径  命令，绘制一 条长 50mm 的直线，点击 命令，先点击线（放样：参照），再点击直线的上端点，点击出现的 ， 将其锁定；点击 命令后，选择       命令，点击编辑轮廓，将视图切换到天花板平面；绘制直径 为 25mm                的圆，并添加如图所示的参数；同理，选择 ，绘制直径为 40mm 的圆，并添加如 图所示的参数。
 










































建立锚头尖端模型。点击“创建”选项卡下的“放样融合”命令，绘制一条 10mm 长的直线作 为放样路径，将其下端点锁定，并对其进行尺寸标注，添加“锚头顶部长度”参数加以锁定；同理， 在轮廓 1 和轮廓 2 分别绘制直径为 25mm 和 5mm 的圆，对应添加“锚头内径”和 “锚头顶部直径” 参数。
 



































创建钢垫板。在前立面图创建放样，在离底部标高 60mm 的参照平面处向下绘制一条长 10mm 的直线，直线上端点对齐锁定至参照平面，添加参数“钢垫板厚度”点击	完成放样路径；同理， 切换至“天花板投影平面”绘制放样轮廓，绘制边长为 150mm 的正方形，绘制直径为 25mm 的圆， 添加如图所示的参数，两次点击	，完成钢垫板的创建。
 





















创建螺母模型。选择放样，在前立面视图中放样路径为 10mm，添加参数“螺母厚度”，直线上 端点与钢垫板下表面锁定，点击 完成放样路径；同理，切换至“天花板投影平面”绘制放样轮廓， 绘制外接圆半径为 30mm 的正六边形和直径为 25mm 的圆，添加如图所示的参数，两次点击 ，完 成螺母的创建。
 

添加材质参数，方法同外衬材质的添加，具体结果见下图。
 
创建多种族类型。打开属性面板中的“族类型”对话框，点击新建，名称栏输入锚杆长度，点 击确定；在公式一栏输入公式实现参数的关联： 锚杆长度=杆身长度+锚头顶部长度，可以发现锚杆 长度变成了 3000mm；通过修改杆身长度的参数值，控制锚杆的长度，创建需要的族类型。












































（2）环向布置锚杆
导入 CAD 图。切换至前立面视图，点击“导入 CAD”命令，选择事先准备好的“sf5a-喷射混
 

凝土”文件并打开，选中导入的图形，点击“完全分解”命令将 CAD 图分解成模型线。
 






































移动锚杆至指定位置。点击“偏移” 命令，将喷射混凝土外轮廓向内偏移 20mm，删除多余 的轮廓线；选中锚杆和绘制的参照平面   1，点击“移动” 命令，将锚杆和参照平面 1 移动沿竖直 方向移动至喷射混凝土轮廓线的中点处。
 


































环向阵列。选中锚杆和参照平面 1，点击“阵列”命令，选择径向阵列，将旋转中心（图中的位 置 3）拖动至（图中的位置 4），点击阵列起始点，输入 18.394 后按回车键，再输入项目数 5，回车， 完成编辑。
 
 









































添加阵列参数。点击阵列模型，在标签栏选择“添加参数”，输入“锚杆个数”，同理，添加参 数“锚杆阵列半径”。在族类型可通过修改锚杆个数和锚杆阵列半径控制环向间距，例如可将锚杆个 数改为 6。
 

































































环向布置另一半锚杆。选中除中心处的其余 4 个锚杆，选择“镜像”	命令，拾取中心线作 为镜像的轴线；删除喷射混凝土的轮廓线，环向间距 2000mm 的锚杆模型建立完成。
 













































由于锚杆布置形式属于梅花型，难以通过参数驱动同时控制环向间距、纵向间距、锚杆个数和 阵列半径，因此可将该族文件另存为“sf5a-25 中空注浆锚杆-3000-2”，将左半部分锚杆旋转角度 9.197°，但是由于不满足限制条件，选择删除限制条件即可（此时阵列的个数和阵列半径不可修改； 同理，旋转右半部分锚杆。
 





















（3）纵向布置锚杆
纵向布置锚杆在项目文件中实现。打开 Revit2016，点击新建项目并确定，将文件保存为 sf5a- 25 中空注浆锚杆.rvt。










载入族文件“sf5a-25 中空注浆锚杆-3000-1.rfa”和“sf5a-25 中空注浆锚杆-3000-2.rfa”。 在场地标高视图中，以项目基点为原点绘制两条参照平面，在项目浏览器中选中族文件 sf5a-25
中空注浆锚杆-3000-1，将其拖动到视图中放置于原点处，同理放置族文件 sf5a-25 中空注浆锚杆- 3000-2。选中放置的实例 sf5a-25 中空注浆锚杆-3000-2，点击“移动” 命令，输入 600，完成纵 向间距的布置。
 

在南立面图和三维视图中查看锚杆布置效果。









































4. 钢架族建模方法
（1）建立槽钢族
新建族文件。打开 Revit2016，点击新建，选择“基于面的公制常规模型”，默认为楼层平面的 参照标高视图；按 ctrl+s 保存族文件，将其命名为槽钢。
 























创建参照平面。点击 “创建”选项卡、 “基准”面板中的参照平面，选择“拾取线” 命令，在“偏 移量”一栏中输入 400，当出现浅绿色虚线时点击鼠标左键完成偏移，将参照平面中心（前/后）上下 各偏移 400；同理，输入 100，将参照平面（中心（前/后））上下各偏移 100，参照平面（中心（上
/下））左右各偏移 100，按 ESC 键退出绘制模式。



























添加尺寸标注和控制参数。单击“注释”选项卡，选择“尺寸标注”面板中的“对齐”命令， 点击两条平行的直线，单击鼠标左键确定，完成尺寸标注；点击尺寸标注，左上方的标签下拉菜单 中，选择添加参数，在弹出的参数属性对话框中，名称栏中输入“螺栓孔间距 L1”，点击“确定”，
完成参数的添加，并点击 进行尺寸约束。连续点击三条平行线，并点击上方的“EQ”，可等间距
控制尺寸；同理，对其他参照平面进行同样的操作。
 

 



























将视图切换到前立面视图，点击“创建”选项卡下的形状面板，选择“拉伸”命令。选择插入 选项卡下的“导入 CAD”命令，在弹出的对话框中选中事先在 CAD 画好的槽钢断面轮廓图。同理， 进行尺寸标注和添加参数，打开属性面板中的族参数命令，可以看见我们所添加的参数名称。
 



































































点击完成 命令，拉伸创建成功。切换至参照标高，选中创建的槽钢模型，点击下方的拉伸（造 型拖动柄）并向下拖动至最下方的参照平面，点击 图标进行对齐锁定，对上方的造型操纵柄进行
 

同样的操作。



















































螺栓孔的建模。在参照标高上，同理采用拉伸命令，采用圆形 工具，以参照平面的一个交点 为圆心，绘制半径为 13mm    的圆；点击复制 命令，选中绘制的圆形，进行复制，形成 4 个圆形； 选择直径尺寸标注，对四个圆形添加尺寸标注，并添加名称为“螺栓孔直径”的参数；点击完成 按钮后，选择属性面板标识数据下拉菜单中的“空心”，点击应用；选中空心模型，点击属性面板下 的拉伸终点右侧的关联族参数，在弹出的关联族参数对话框中选择“槽钢厚度”，点击确定，空心的 螺栓孔模型创建完成。
 




































































空心模型剪切槽钢主体。点击“剪切几何图形”命令，移动鼠标至空心模型，点击空心模型后，
 

再点击实心槽钢模型，完成剪切。点击三维视图图标，在三维视图中查看带螺栓孔的槽钢效果图。




























































修改参数，进行调试。点击属性面板中的族类型命令，在弹出的族类型对话框中点击新建，输 入“槽钢 28a”，即创建一个名称为的族类型；同理新建“槽钢 25a”和“槽钢 32a”两个族类型，输 入新的尺寸数值，点击确定，完成三种尺寸的槽钢模型。
 




































































添加材质参数。选择“管理”选项卡下的材质面板，在材质浏览器中选择下拉菜单中的 AEC 材
 

质，点击金属，下拉至金属中的钢材，双击钢，43-245，则在项目材质列表中出现钢，43-245，点击 右侧的标识项，将名称改为钢材 Q235，说明改为结构钢 Q235，点击确定；选中槽钢模型，在属性 面板中的材质与装饰项选择右侧的关联族参数，点击添加参数，参数名称输入槽钢材料，点击确定； 打开族类型对话框，将鼠标放置于图中所示的小按钮，点击小按钮，选择钢材 Q235，点击确定。
 
 

 
 




























创建.txt 文件，控制可载入族的类型。新建 excel 文件，保存文件名称为槽钢（必须与族文件名 称保持一致）；将此 Excel 文件导出为.CSV 文件，再将.CSV 文件的拓展名改为.txt（.txt 文件必须与 该族文件存放在同一文件夹之下。）





















（2）建立接头钢板族 接头钢板族的建立过程可参考槽钢族。但是，为控制螺栓孔间距与接头钢板边长的相对位置，
在弹出的“族类型”对话框中的公式列，螺栓孔间距行中输入“接头钢板-120mm”。
 
















































（3）建立钢架嵌套族（以 I18a 为例）
打开 Revit2016，选择族样板中的公制常规模型，创建一个新的族，保存为“sf5a-工字钢架 18a- 600”（其中 600 表示每榀钢架的间距），点击确定。
 













































放样。将视图切换至右立面视图，单击创建选项卡、形状面板下的放样命令，点击“绘制路径”； 同理，导入准备好的一段工字钢架 CAD 轴线图，选择 ，完成工字钢放样路径的绘制；点击“选择 轮廓”下的“编辑轮廓”命令，在弹出的对话框中选择“立面：前”、“打开视图”，切换至前立面视 图，参照槽钢的做法，插入准备好的工字钢断面轮廓图，同理添加尺寸标注和参数，两次点击 ， 完成该段工字钢架的模型。
 



 
 





























建立剩余段工字钢架。切换至右立面视图，选中建立好的一段工字钢，点击复制 命令，并配 合使用旋转 命令，建立三段新的工字钢架（这三段圆心角相同，均为 40°）；参照上述方法，建 立剩余段的工字钢架。值得注意的是，由于各段工字钢架的圆心角不尽相同，不能直接复制或者阵 列实现全部段工字钢架的模型，应严格按照轴线的信息来分段拼接。



















接头处理。针对上述存在的交叉重叠现象，利用拉伸命令建立空心模型可进行剪切，具体操作 同槽钢螺栓孔的剪切，不再赘述；
导入可载入族。点击插入选项卡中的 “载入族”命令，在弹出的对话框中选中已经建立的槽钢 族和接头钢板族，单击“打开”，在弹出的“指定类型”对话框中选择接头钢板 220 和槽钢 28a，点 击确定。
 



















































导入系统族。点击插入选项卡中的 “载入族”命令，选择 Libraries→China→结构→结构连接
→钢→普通 B 级六角头螺栓，选择 M24 类型，点击打开。导入之后，在项目浏览器→族→常规模型 和结构连接中可以找到上述方法载入的族文件。
 































































工字钢架接头连接。沿接缝处建立一个参照平面，选择“建筑”选项卡、“工作平面”面板下的 “设置”命令，在弹出的对话框中选择“拾取一个平面”，点击确定；将鼠标移动到建立的参照平面， 点击后弹出“转出视图”对话框，选择三维视图并打开；点击小米浏览器中的接头钢板 220 并拖动
 

到三维视图中，选择“放置在工作平面上”，放置完成后，切换到右立面和前立面视图，调整接头钢 板的位置至接缝中心；同理，放置剩余的接头钢板。槽钢和螺栓可按照上述方法操作，放置至正确 的位置，完成一榀钢架族的模型建立。
 

 

同理，放置剩余的接头钢板。槽钢和螺栓可按照上述方法操作，放置至正确的位置，完成一榀 钢架族的模型建立。
 




















 

 
























 
